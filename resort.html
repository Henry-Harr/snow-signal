<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Snow Signal — Resort</title>
<style>
  :root {
    --text:#111; --muted:#444; --accent:#3c8bff;
    --bar:#000; --bar-hover:#555;
    --today:#7aa137; --tmr:#9edd3a; --d3:#b7ff4a;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:#fff;
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  .wrap{
    max-width:1200px;
    margin:50px auto;
    padding:0 24px;
  }
  h1{
    font-size:64px;
    margin:0;
    font-weight:700;
  }
  h2{
    font-size:40px;
    margin:24px 0 12px;
    font-weight:600;
  }
  .grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:48px;
    align-items:start;
    margin-top:20px;
  }
  .snow-info{
    margin-top:20px;
    font-size:22px;
    line-height:1.8;
  }
  /* --- 7-day snowfall bars --- */
  .snow-bars{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:10px;
    margin-top:30px;
  }
  .bar{
    width:60px;
    background:var(--bar);
    border-radius:4px 4px 0 0;
    transition:background .2s, transform .2s;
  }
  .bar:hover{background:var(--bar-hover);transform:translateY(-4px);}
  .bar-label{
    text-align:center;
    font-size:16px;
    margin-top:4px;
  }
  .bar-inch{
    text-align:center;
    font-weight:600;
    font-size:18px;
  }
  /* --- Stoke Ratings --- */
  .ratings{
    display:flex;
    justify-content:space-around;
    margin-top:40px;
  }
  .rating{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
  }
  .tower{
    width:80px;
    height:180px;
    border-radius:4px 4px 0 0;
    background:var(--today);
    transition:transform .2s;
  }
  .tower:hover{transform:translateY(-6px);}
  .tower.tmr{background:var(--tmr);}
  .tower.d3{background:var(--d3);}
  .rating-text{font-size:22px;font-weight:600;}
  .reason{font-size:18px;color:var(--muted);}
  @media(max-width:900px){
    .grid{grid-template-columns:1fr;}
    h1{font-size:48px;}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1 id="resortTitle">Ski Resort</h1>

  <div class="grid">
    <!-- Left: Snowfall -->
    <section>
      <div class="snow-info">
        Season Snowfall: <span id="seasonSnow">x</span> inches<br>
        Last 24 hours: <span id="last24">x</span> inches<br>
        Last 72 hours: <span id="last72">x</span> inches
      </div>

      <h2>7 Day Snowfall:</h2>
      <div class="snow-bars" id="snowBars">
        <!-- JS fills -->
      </div>
    </section>

    <!-- Right: Ratings -->
    <section>
      <h2>Stoke Rating:</h2>
      <div class="ratings">
        <div class="rating">
          <div class="tower" id="tower-td"></div>
          <div class="rating-text" id="rt-td">Rating</div>
          <div class="reason" id="rs-td">Reason</div>
        </div>
        <div class="rating">
          <div class="tower tmr" id="tower-tmr"></div>
          <div class="rating-text" id="rt-tmr">Rating</div>
          <div class="reason" id="rs-tmr">Reason</div>
        </div>
        <div class="rating">
          <div class="tower d3" id="tower-d3"></div>
          <div class="rating-text" id="rt-d3">Rating</div>
          <div class="reason" id="rs-d3">Reason</div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Papa Parse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTGijpvcmz6TA1HWmDc4njQx7vS0gZ4WSfUrw2EgLT9_aVOX3LFfyIL3datSI9gVswmUadZuHoGx6Hw/pub?output=csv";
const COLS = {
  resort:"skiresort",
  ratingTd:"rating_td", ratingTmr:"rating_tmr", ratingD3:"rating_day3",
  reasonTd:"reason_td", reasonTmr:"reason_tmr", reasonD3:"reason_day3",
  season:"seasonsnow", last24:"last24hr", last72:"last72hr",
  d1:"snow24h", d2:"tmrsnow", d3:"3snow", d4:"4snow", d5:"5snow", d6:"6snow", d7:"7snow"
};
const $=id=>document.getElementById(id);
const toNum=v=>{const m=String(v||"").match(/-?\\d+(\\.\\d+)?/);return m?+m[0]:0;};
const ratingColor=(r)=>({"poor":"#9b1c1c","fair":"#f59e0b","good":"#84cc16","excellent":"#22c55e","all time":"#16a34a"}[r.toLowerCase()]||"#999");

async function main(){
  const name = new URLSearchParams(location.search).get("resort")||"";
  $("resortTitle").textContent = name || "Ski Resort";

  const res = await fetch(CSV_URL); const text = await res.text();
  const parsed = Papa.parse(text,{header:true,skipEmptyLines:true});
  const row = parsed.data.find(r => (r[COLS.resort]||"").toLowerCase()===name.toLowerCase());
  if(!row) return alert("Resort not found in sheet.");

  $("seasonSnow").textContent = toNum(row[COLS.season]).toFixed(1);
  $("last24").textContent = toNum(row[COLS.last24]).toFixed(1);
  $("last72").textContent = toNum(row[COLS.last72]).toFixed(1);

  // 7-day chart
  const days = ["d1","d2","d3","d4","d5","d6","d7"];
  const data = days.map(d=>toNum(row[COLS[d]]));
  const max = Math.max(...data,6);
  $("snowBars").innerHTML = data.map((v,i)=>{
    const d = new Date(Date.now() + i*86400000);
    const label = d.toLocaleDateString(undefined,{month:"short",day:"numeric"});
    const h = (v/max)*140;
    return `<div>
      <div class="bar" style="height:${h}px"></div>
      <div class="bar-label">${label}</div>
      <div class="bar-inch">${v.toFixed(1)}"</div>
    </div>`;
  }).join("");

  // Ratings
  [["td","ratingTd","reasonTd"],["tmr","ratingTmr","reasonTmr"],["d3","ratingD3","reasonD3"]]
  .forEach(([tag,rc,rs])=>{
    const rating=(row[COLS[rc]]||"").trim();
    const reason=(row[COLS[rs]]||"").trim();
    $(`tower-${tag}`).style.background = ratingColor(rating||"");
    $(`rt-${tag}`).textContent = rating ? rating.charAt(0).toUpperCase()+rating.slice(1) : "—";
    $(`rs-${tag}`).textContent = reason || "";
  });
}
window.addEventListener("load",main);
</script>
</body>
</html>

